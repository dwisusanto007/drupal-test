{#
/**
 * @file
 * Template for an Event node in 'card' view mode.
 *
 * Card layout (matches wireframe):
 *   1. Image (full width)
 *   2. Date  — raw value, formatted via Twig date filter (no field label)
 *   3. Intro description — stripped of HTML, truncated (no field label)
 *   4. "Detail" button (bottom right)
 *
 * Raw field access is used for date and description so Drupal field
 * labels are never rendered.
 *
 * Variables:
 * - node: The node entity.
 * - label: Node title.
 * - content.field_event_image: Rendered image field.
 * - node.field_event_date.value: Start date string (Y-m-d).
 * - node.field_event_description.value: Raw HTML description.
 * - card_url: Added by mytheme_preprocess_node().
 *
 * BEM: .card .card--event
 */
#}
{%
  set classes = [
    'card',
    'card--event',
    not node.isPublished() ? 'card--unpublished',
  ]
%}
<article{{ attributes.addClass(classes) }}>

  {# --- Image — rendered directly via file_url() to bypass formatter --- #}
  {% if node.field_event_image.entity %}
    <div class="card__image">
      <a href="{{ card_url }}" tabindex="-1" aria-hidden="true">
        <img
          src="{{ file_url(node.field_event_image.entity.uri.value) }}"
          alt="{{ node.field_event_image.alt ?: label }}"
          loading="lazy"
        />
      </a>
    </div>
  {% else %}
    <div class="card__image card__image--placeholder" aria-hidden="true"></div>
  {% endif %}

  <div class="card__body">

    {# --- Date (formatted, no label) --- #}
    {% if node.field_event_date.value %}
      <div class="card__date">
        {{ node.field_event_date.value|date('j F Y') }}
      </div>
    {% endif %}

    {# --- Title --- #}
    {{ title_prefix }}
    <h3{{ title_attributes.addClass('card__title') }}>
      <a href="{{ card_url }}">{{ label }}</a>
    </h3>
    {{ title_suffix }}

    {# --- Description intro (plain text, no label) --- #}
    {% if node.field_event_description.value %}
      {% set plain = node.field_event_description.value|striptags %}
      <div class="card__description">
        {{ plain|slice(0, 180) }}{% if plain|length > 180 %}…{% endif %}
      </div>
    {% endif %}

    {# --- Detail button --- #}
    <div class="card__footer">
      <a href="{{ card_url }}" class="card__btn">
        {{ 'Detail'|t }}
        <span class="visually-hidden"> {{ 'of'|t }} {{ label }}</span>
      </a>
    </div>

  </div>

</article>
